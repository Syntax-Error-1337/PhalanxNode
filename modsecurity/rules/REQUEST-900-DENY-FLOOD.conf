# Custom Flood Protection Rules
# ID Range: 900000-900999

# Block IP if more than 100 requests in 60 seconds
SecRule REQUEST_HEADERS:User-Agent "@unconditionalMatch" \
    "id:900100,\
    phase:1,\
    pass,\
    nolog,\
    initcol:ip=%{REMOTE_ADDR},\
    setvar:ip.request_count=+1,\
    expirevar:ip.request_count=60"

SecRule IP:request_count "@gt 100" \
    "id:900101,\
    phase:1,\
    deny,\
    status:429,\
    log,\
    msg:'Rate Limit Exceeded (ModSecurity): %{REMOTE_ADDR}'"
